on:
  push:
    branches:
      - master
    paths-ignore:
      - ".github/**"
      - ".vscode/**"
      - "assets/**"
      - "demo/**"
      - ".gitignore"
      - ".vscodeignore"
      - "changelog.md"
      - "node_modules"
      - "package.json"
      - "package-lock.json"
      - "readme.md"

name: Deploy Extension
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # - name: checkout repo
      #   uses: actions/checkout@v2

      # - name: fetch all history and tags from all branches for gitversion
      #   run: git fetch --prune --unshallow

      # - name: install gitversion tool
      #   uses: gittools/actions/gitversion/setup@v0.9
      #   with:
      #     versionSpec: "5.1.x"

      # - name: setup node
      #   uses: actions/setup-node@v1
      #   with:
      #     node-version: "12.x"

      # - name: clean install dependencies
      #   run: npm ci

      # - name: add version in CHANGELOG.md
      #   uses: cschleiden/replace-tokens@v1.0
      #   with:
      #     files: "${{github.workspace}}/CHANGELOG.md"
      #   env:
      #     VERSION: "${{ steps.gitversion.outputs.semVer }}"

      # - name: compile and create vsix
      #   run: npm run package
      # - name: upload vsix as artifact
      #   uses: actions/upload-artifact@v2
      #   with:
      #     name: rose-pine-0.3.6.vsix
      #     path: ${{github.workspace}}/rose-pine-0.3.6.vsix
      - name: publish to marketplace
        uses: lannonbr/vsce-action@master
        with:
          args: "publish -p $VSCE_TOKEN"
        env:
          VSCE_TOKEN: ${{ secrets.PAT }}
      # - name: create a release
      #   if: github.ref == 'refs/heads/master'
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: v0.3.6
      #     release_name: v0.3.6
